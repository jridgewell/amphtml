(window.AMP = window.AMP || []).push(function(AMP) {var process={env:{NODE_ENV:"production"}};var f="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;function h(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(f.Object.defineProperties){var e=f.Object.getOwnPropertyDescriptor(b,d);void 0!==e&&f.Object.defineProperty(a,d,e)}else a[d]=b[d]};var k=null,p="";var q=(new Date).getTime();function r(a,b,c){this.win=a.AMP_TEST?a.parent:a;this.levelFunc_=b;this.level_=this.calcLevel_();this.suffix_=c||""}
r.prototype.calcLevel_=function(){var a;if(k)a=k;else{if(window.context&&window.context.mode)a=window.context.mode;else{a=("localhost"==location.hostname||location.ancestorOrigins&&location.ancestorOrigins[0]&&0==location.ancestorOrigins[0].indexOf("http://localhost:"))&&!!document.querySelector('script[src*="/dist/"],script[src*="/base/"]');var b=location.originalHash||location.hash,c=Object.create(null);if(b){if(0==b.indexOf("?")||0==b.indexOf("#"))b=b.substr(1);for(var b=b.split("&"),d=0;d<b.length;d++){var e=
b[d],g=e.indexOf("="),m=void 0,n=void 0;-1!=g?(m=decodeURIComponent(e.substring(0,g)).trim(),n=decodeURIComponent(e.substring(g+1)).trim()):(m=decodeURIComponent(e).trim(),n="");m&&(c[m]=n)}}p||(p=a?"1463506055389":window.AMP_CONFIG&&window.AMP_CONFIG.v?window.AMP_CONFIG.v:"1463506055389");a={localDev:a,development:"1"==c.development||window.AMP_DEV_MODE,filter:c.filter,minified:"production"==process.env.NODE_ENV,test:window.AMP_TEST,log:c.log,version:p}}a=k=a}return this.win.console&&
this.win.console.log&&"0"!=a.log?this.win.ENABLE_LOG?4:a.localDev&&!a.log?3:this.levelFunc_(a):0};r.prototype.msg_=function(a,b,c){if(0!=this.level_){var d=this.win.console.log;"ERROR"==b?d=this.win.console.error||d:"INFO"==b?d=this.win.console.info||d:"WARN"==b&&(d=this.win.console.warn||d);c.unshift((new Date).getTime()-q,"["+a+"]");d.apply(this.win.console,c)}};r.prototype.isEnabled=function(){return 0!=this.level_};
r.prototype.fine=function(a,b){4<=this.level_&&this.msg_(a,"FINE",Array.prototype.slice.call(arguments,1))};r.prototype.info=function(a,b){3<=this.level_&&this.msg_(a,"INFO",Array.prototype.slice.call(arguments,1))};r.prototype.warn=function(a,b){2<=this.level_&&this.msg_(a,"WARN",Array.prototype.slice.call(arguments,1))};
r.prototype.error=function(a,b){if(1<=this.level_)this.msg_(a,"ERROR",Array.prototype.slice.call(arguments,1));else{var c=t.apply(null,Array.prototype.slice.call(arguments,1));this.prepareError_(c);this.win.setTimeout(function(){throw c;})}};r.prototype.createError=function(a){var b=t.apply(null,arguments);this.prepareError_(b);return b};
r.prototype.assert=function(a,b,c){var d=void 0;if(!a){var e=(b||"Assertion failed").split("%s"),g=e.shift(),m=g,n=[];""!=g&&n.push(g);for(g=2;g<arguments.length;g++){var l=arguments[g];l&&l.tagName&&(d=l);var y=e.shift();n.push(l);var z=y.trim();""!=z&&n.push(z);l=l instanceof Element?l.tagName.toLowerCase()+(l.id?"#"+l.id:""):l;m+=l+y}e=Error(m);e.fromAssert=!0;e.associatedElement=d;e.messageArray=n;this.prepareError_(e);throw e;}return a};
r.prototype.assertEnumValue=function(a,b,c){for(var d in a)if(a[d]==b)return a[d];this.assert(!1,'Unknown %s value: "%s"',c||"enum",b)};r.prototype.prepareError_=function(a){this.suffix_&&(a.message?-1==a.message.indexOf(this.suffix_)&&(a.message+=this.suffix_):a.message=this.suffix_)};function t(a){for(var b=null,c="",d=0;d<arguments.length;d++){var e=arguments[d];e instanceof Error&&!b?b=e:(c&&(c+=" "),c+=e)}b?c&&(b.message=c+": "+b.message):b=Error(c);return b}
function u(a){var b=t.apply(null,arguments);setTimeout(function(){throw b;})}var v=new r(window,function(a){var b=parseInt(a.log,10);return a.development||1<=b?4:0},"\u200b\u200b\u200b"),w=new r(window,function(a){a=parseInt(a.log,10);return 3<=a?4:2<=a?3:0});function x(a,b){if(b.length>a.length)return!1;var c=a.length-b.length;return a.indexOf(b,c)==c};var A=window.document.createElement("a"),B=Object.create(null);
function C(a){var b=B[a];if(b)return b;A.href=a;var b={href:A.href,protocol:A.protocol,host:A.host,hostname:A.hostname,port:"0"==A.port?"":A.port,pathname:A.pathname,search:A.search,hash:A.hash},c;A.origin&&"null"!=A.origin?c=A.origin:(c=b,"string"==typeof c&&(c=C(c)),c="data:"!=c.protocol&&c.host?c.protocol+"//"+c.host:c.href);b.origin=c;v.assert(b.origin,"Origin must exist");B[a]=window.AMP_TEST&&Object.freeze?Object.freeze(b):b;return b}
function D(a,b,c){if(!b)return a;a=a.split("#",2);var d=a[0].split("?",2);b=d[0]+(d[1]?c?"?"+b+"&"+d[1]:"?"+d[1]+"&"+b:"?"+b);return b+=a[1]?"#"+a[1]:""}function E(a,b){var c=Object.keys(b).reduce(function(a,c){return a+("&"+encodeURIComponent(c)+"="+encodeURIComponent(b[c]))},"");return D(a,c.substring(1))}
function F(a,b){v.assert(null!=a,"%s source must be available",b);var c=C(a);v.assert("https:"==c.protocol||/^(\/\/)/.test(a)||"localhost"==c.hostname||x(c.hostname,".localhost"),'%s source must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,a);return a};function G(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){var e=new d.MutationObserver(function(){b(a)&&(e.disconnect(),c())});e.observe(a,{childList:!0})}else var g=d.setInterval(function(){b(a)&&(d.clearInterval(g),c())},5)}}function H(a,b){G(a.documentElement,function(){return!!a.body},b)}function I(a){return new Promise(function(b){H(a,b)})};function J(a,b,c){var d=K(a),e=d[b];e||(e=d[b]={obj:null,promise:null,resolve:null});e.obj||(e.obj=c(a),e.promise||(e.promise=Promise.resolve(e.obj)),e.resolve&&e.resolve(e.obj));return e.obj}function L(a,b){var c=K(a),d=c[b];if(d)return d.promise;var e=void 0,d=new Promise(function(a){e=a});c[b]={obj:null,promise:d,resolve:e};return d}function M(a,b){var c=K(a);return c[b]?c[b].promise:null}function K(a){var b=a.services;b||(b=a.services={});return b};function N(a,b,c){return O(a,b,c).then(function(a){return v.assert(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",b,c,c,c)})}function O(a,b,c){var d=M(a,b);return d?d:Promise.resolve().then(function(){return a.ampExtendedElements[c]?L(a,b):I(a.document).then(function(){return a.ampExtendedElements[c]?L(a,b):null})})};function P(a,b){var c="loading"!=a.readyState;if(c)b();else{var d=function(){"loading"!=a.readyState&&(c||(c=!0,b()),a.removeEventListener("readystatechange",d))};a.addEventListener("readystatechange",d)}}function Q(a){return new Promise(function(b){P(a,b)})};function R(a){AMP.BaseElement.apply(this,arguments)}h(R,AMP.BaseElement);R.prototype.createdCallback=function(){this.win_=this.getWin();this.urlReplacements_=J(this.win_,"url-replace");this.userNotificationManager_=S(this.win_);this.storagePromise_=N(this.win_,"storage","amp-analytics")};
R.prototype.buildCallback=function(){var a=this;this.dialogResolve_=this.ampUserId_=null;this.dialogPromise_=new Promise(function(b){a.dialogResolve_=b});this.elementId_=v.assert(this.element.id,"amp-user-notification should have an id.");this.storageKey_="amp-user-notification:"+this.elementId_;(this.showIfHref_=this.element.getAttribute("data-show-if-href"))&&F(this.showIfHref_,this.element);(this.dismissHref_=this.element.getAttribute("data-dismiss-href"))&&F(this.dismissHref_,this.element);var b=
this.element.getAttribute("data-persist-dismissal");this.persistDismissal_="false"!=b&&"no"!=b;this.userNotificationManager_.registerUserNotification(this.elementId_,this);this.registerAction("dismiss",this.dismiss.bind(this))};R.prototype.buildGetHref_=function(a){var b=this;return this.urlReplacements_.expand(this.showIfHref_).then(function(c){return E(c,{elementId:b.elementId_,ampUserId:a})})};
R.prototype.getShowEndpoint_=function(a){var b=this;this.ampUserId_=a;return this.buildGetHref_(a).then(function(a){return J(b.win_,"xhr").fetchJson(a,{credentials:"include"})})};R.prototype.postDismissEnpoint_=function(){return J(this.win_,"xhr").fetchJson(this.dismissHref_,{method:"POST",credentials:"include",body:{elementId:this.elementId_,ampUserId:this.ampUserId_}})};
R.prototype.onGetShowEndpointSuccess_=function(a){v.assert("boolean"==typeof a.showNotification,'`showNotification` should be a boolean. Got "%s" which is of type %s.',a.showNotification,typeof a.showNotification);a.showNotification||this.dialogResolve_();return Promise.resolve(a.showNotification)};R.prototype.getAsyncCid_=function(){var a=this;return N(this.win_,"cid","amp-analytics").then(function(b){return b.get({scope:"amp-user-notification",createCookieIfNotPresent:!0},Promise.resolve(),a.dialogPromise_)})};
R.prototype.shouldShow=function(){var a=this,b=void 0;if(this.persistDismissal_)var c=this,b=this.storagePromise_.then(function(a){return a.get(c.storageKey_)});else b=Promise.resolve(null);return b.catch(function(a){w.error("amp-user-notification","Failed to read storage",a);return!1}).then(function(b){return b?!1:a.showIfHref_?a.shouldShowViaXhr_():!0})};R.prototype.shouldShowViaXhr_=function(){return this.getAsyncCid_().then(this.getShowEndpoint_.bind(this)).then(this.onGetShowEndpointSuccess_.bind(this))};
R.prototype.show=function(){this.element.style.display="";this.element.classList.add("amp-active");this.getViewport().addToFixedLayer(this.element);return this.dialogPromise_};R.prototype.dismiss=function(){this.element.classList.remove("amp-active");this.element.classList.add("amp-hidden");this.dialogResolve_();this.getViewport().removeFromFixedLayer(this.element);if(this.persistDismissal_){var a=this;this.storagePromise_.then(function(b){b.set(a.storageKey_,!0)})}this.dismissHref_&&this.postDismissEnpoint_()};
function T(a){this.win_=a;this.deferRegistry_=Object.create(null);this.viewer_=J(this.win_,"viewer");this.nextInQueue_=this.managerReadyPromise_=Promise.all([this.viewer_.whenFirstVisible(),Q(this.win_.document)])}T.prototype.get=function(a){var b=this;this.managerReadyPromise_.then(function(){null==b.win_.document.getElementById(a)&&v.warn("amp-user-notification","Did not find amp-user-notification element "+a+".")});return this.getElementDeferById_(a).promise};
T.prototype.registerUserNotification=function(a,b){var c=this.getElementDeferById_(a);return this.nextInQueue_=this.nextInQueue_.then(function(){return b.shouldShow().then(function(a){if(a)return b.show()})}).then(c.resolve).catch(u.bind(null,"Notification service failed amp-user-notification",a))};T.prototype.getElementDeferById_=function(a){return this.createOrReturnDefer_(a)};
T.prototype.createOrReturnDefer_=function(a){if(this.deferRegistry_[a])return this.deferRegistry_[a];var b=void 0,c=new Promise(function(a){b=a});return this.deferRegistry_[a]={promise:c,resolve:b}};function S(a){return J(a,"userNotificationManager",function(){return new T(a)})}S(AMP.win);AMP.registerElement("amp-user-notification",R,"amp-user-notification{position:fixed!important;bottom:0;left:0;overflow:hidden!important;visibility:hidden;background:hsla(0,0%,100%,.7);z-index:1000;width:100%}amp-user-notification.amp-active{visibility:visible}amp-user-notification.amp-hidden{visibility:hidden}\n/*# sourceURL=/extensions/amp-user-notification/0.1/amp-user-notification.css*/");
});
//# sourceMappingURL=amp-user-notification-0.1.js.map

