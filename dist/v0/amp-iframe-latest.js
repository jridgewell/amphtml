(window.AMP = window.AMP || []).push(function(AMP) {var process={env:{NODE_ENV:"production"}};var g="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;function m(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(g.Object.defineProperties){var e=g.Object.getOwnPropertyDescriptor(b,d);void 0!==e&&g.Object.defineProperty(a,d,e)}else a[d]=b[d]};var n=null,p="";var q=(new Date).getTime();function r(a,b,c){this.win=a.AMP_TEST?a.parent:a;this.levelFunc_=b;this.level_=this.calcLevel_();this.suffix_=c||""}
r.prototype.calcLevel_=function(){var a;if(n)a=n;else{if(window.context&&window.context.mode)a=window.context.mode;else{a=("localhost"==location.hostname||location.ancestorOrigins&&location.ancestorOrigins[0]&&0==location.ancestorOrigins[0].indexOf("http://localhost:"))&&!!document.querySelector('script[src*="/dist/"],script[src*="/base/"]');var b=location.originalHash||location.hash,c=Object.create(null);if(b){if(0==b.indexOf("?")||0==b.indexOf("#"))b=b.substr(1);for(var b=b.split("&"),d=0;d<b.length;d++){var e=
b[d],f=e.indexOf("="),h=void 0,k=void 0;-1!=f?(h=decodeURIComponent(e.substring(0,f)).trim(),k=decodeURIComponent(e.substring(f+1)).trim()):(h=decodeURIComponent(e).trim(),k="");h&&(c[h]=k)}}p||(p=a?"1463506055389":window.AMP_CONFIG&&window.AMP_CONFIG.v?window.AMP_CONFIG.v:"1463506055389");a={localDev:a,development:"1"==c.development||window.AMP_DEV_MODE,filter:c.filter,minified:"production"==process.env.NODE_ENV,test:window.AMP_TEST,log:c.log,version:p}}a=n=a}return this.win.console&&
this.win.console.log&&"0"!=a.log?this.win.ENABLE_LOG?4:a.localDev&&!a.log?3:this.levelFunc_(a):0};r.prototype.msg_=function(a,b,c){if(0!=this.level_){var d=this.win.console.log;"ERROR"==b?d=this.win.console.error||d:"INFO"==b?d=this.win.console.info||d:"WARN"==b&&(d=this.win.console.warn||d);c.unshift((new Date).getTime()-q,"["+a+"]");d.apply(this.win.console,c)}};r.prototype.isEnabled=function(){return 0!=this.level_};
r.prototype.fine=function(a,b){4<=this.level_&&this.msg_(a,"FINE",Array.prototype.slice.call(arguments,1))};r.prototype.info=function(a,b){3<=this.level_&&this.msg_(a,"INFO",Array.prototype.slice.call(arguments,1))};r.prototype.warn=function(a,b){2<=this.level_&&this.msg_(a,"WARN",Array.prototype.slice.call(arguments,1))};
r.prototype.error=function(a,b){if(1<=this.level_)this.msg_(a,"ERROR",Array.prototype.slice.call(arguments,1));else{var c=t.apply(null,Array.prototype.slice.call(arguments,1));this.prepareError_(c);this.win.setTimeout(function(){throw c;})}};r.prototype.createError=function(a){var b=t.apply(null,arguments);this.prepareError_(b);return b};
r.prototype.assert=function(a,b,c){var d=void 0;if(!a){var e=(b||"Assertion failed").split("%s"),f=e.shift(),h=f,k=[];""!=f&&k.push(f);for(f=2;f<arguments.length;f++){var l=arguments[f];l&&l.tagName&&(d=l);var D=e.shift();k.push(l);var E=D.trim();""!=E&&k.push(E);l=l instanceof Element?l.tagName.toLowerCase()+(l.id?"#"+l.id:""):l;h+=l+D}e=Error(h);e.fromAssert=!0;e.associatedElement=d;e.messageArray=k;this.prepareError_(e);throw e;}return a};
r.prototype.assertEnumValue=function(a,b,c){for(var d in a)if(a[d]==b)return a[d];this.assert(!1,'Unknown %s value: "%s"',c||"enum",b)};r.prototype.prepareError_=function(a){this.suffix_&&(a.message?-1==a.message.indexOf(this.suffix_)&&(a.message+=this.suffix_):a.message=this.suffix_)};function t(a){for(var b=null,c="",d=0;d<arguments.length;d++){var e=arguments[d];e instanceof Error&&!b?b=e:(c&&(c+=" "),c+=e)}b?c&&(b.message=c+": "+b.message):b=Error(c);return b}
var u=new r(window,function(a){var b=parseInt(a.log,10);return a.development||1<=b?4:0},"\u200b\u200b\u200b");new r(window,function(a){a=parseInt(a.log,10);return 3<=a?4:2<=a?3:0});function v(a,b){if(b.length>a.length)return!1;var c=a.length-b.length;return a.indexOf(b,c)==c};var w=window.document.createElement("a"),x=Object.create(null);
function y(a){var b=x[a];if(b)return b;w.href=a;var b={href:w.href,protocol:w.protocol,host:w.host,hostname:w.hostname,port:"0"==w.port?"":w.port,pathname:w.pathname,search:w.search,hash:w.hash},c;w.origin&&"null"!=w.origin?c=w.origin:(c=b,"string"==typeof c&&(c=y(c)),c="data:"!=c.protocol&&c.host?c.protocol+"//"+c.host:c.href);b.origin=c;u.assert(b.origin,"Origin must exist");x[a]=window.AMP_TEST&&Object.freeze?Object.freeze(b):b;return b};function z(a){this.win=a;this.resolved_=Promise.resolve();this.taskCount_=0;this.canceled_={};this.startTime_=this.now()}z.prototype.now=function(){return Date.now()};z.prototype.timeSinceStart=function(){return this.now()-this.startTime_};z.prototype.delay=function(a,b){if(!b){var c=this,d="p"+this.taskCount_++;this.resolved_.then(function(){c.canceled_[d]?delete c.canceled_[d]:a()});return d}return this.win.setTimeout(a,b)};
z.prototype.cancel=function(a){"string"==typeof a?this.canceled_[a]=!0:this.win.clearTimeout(a)};z.prototype.promise=function(a,b){var c=this,d=null;return(new Promise(function(e,f){d=c.delay(function(){d=-1;e(b)},a);-1==d&&f(Error("Failed to schedule timer."))})).catch(function(a){-1!=d&&c.cancel(d);throw a;})};
z.prototype.timeoutPromise=function(a,b,c){var d=this,e=null,f=(new Promise(function(b,f){e=d.delay(function(){e=-1;f(u.createError(c||"timeout"))},a);-1==e&&f(Error("Failed to schedule timer."))})).catch(function(a){-1!=e&&d.cancel(e);throw a;});return b?Promise.race([f,b]):f};var A=new z(window);function B(a,b,c,d){function e(a){c(a);h()}var f=d||!1,h=void 0,h=function(){a&&a.removeEventListener(b,e,f);e=a=null};a.addEventListener(b,e,f);return h}
function C(a,b){var c=void 0,d=void 0,e=new Promise(function(b,e){a.complete||"complete"==a.readyState?b(a):(c="AUDIO"===a.tagName||"VIDEO"===a.tagName?B(a,"loadstart",function(){return b(a)}):B(a,"load",function(){return b(a)}),d=B(a,"error",function(){e(u.createError("Failed HTTP request for %s.",a))}))});return F(e,function(){c&&c();d&&d()},b)}function F(a,b,c){var d=void 0,d=void 0===c?a:A.timeoutPromise(c||0,a);return b?d.then(function(a){b();return a},function(a){b();throw a;}):d};function G(){this.handlers_=[]}G.prototype.add=function(a){var b=this;this.handlers_.push(a);return function(){b.remove(a)}};G.prototype.remove=function(a){for(var b=0;b<this.handlers_.length;b++)if(a==this.handlers_[b]){this.handlers_.splice(b,1);break}};G.prototype.fire=function(a){this.handlers_.forEach(function(b){b(a)})};G.prototype.getHandlerCount=function(){return this.handlers_.length};function H(a,b,c){var d=a.listeningFors;!d&&c&&(d=a.listeningFors=Object.create(null));a=d||null;if(!a)return a;d=a[b];!d&&c&&(d=a[b]=[]);return d||null}function I(a,b){for(var c=y(b.src).origin,c=H(a,c,!0),d=void 0,e=0;e<c.length;e++){var f=c[e];if(f.frame===b){d=f;break}}d||(d={frame:b,events:Object.create(null)},c.push(d));return d.events}
function J(a){for(var b={sentinel:"unlisten"},c=a.length-1;0<=c;c--){var d=a[c];if(!d.frame.contentWindow){a.splice(c,1);var d=d.events,e;for(e in d)d[e].splice(0,Infinity).forEach(function(a){a(b)})}}}
function K(a){a.listeningFors||a.addEventListener("message",function(b){if(b.data){var c;c=b.source;var d=H(a,b.origin);if(d){for(var e=void 0,f=0;f<d.length;f++){var h=d[f],k=h.frame.contentWindow;if(!k)setTimeout(J,0,d);else if(k===c){e=h;break}}c=e?e.events:null}else c=d;if(c){b=b.data;if("string"===typeof b&&"{"===b.charAt(0))try{b=JSON.parse(b)}catch(l){log.warn("Postmessage could not be parsed. Is it in a valid JSON format?",l)}if(c=c[b.type])for(c=c.slice(),d=0;d<c.length;d++)(0,c[d])(b)}}})}
function L(a,b,c,d){function e(a){"unlisten"==a.sentinel?l():a.sentinel==h&&c(a)}var f=a.ownerDocument.defaultView;K(f);a=I(f,a);var h=M(d),k=a[b]||(a[b]=[]),l=void 0;k.push(e);return l=function(){if(e){var a=k.indexOf(e);-1<a&&k.splice(a,1);c=k=e=null}}}function M(a){return a?"amp-5ece11a3f055ead22ca35531763046ffb704f1193dec88a9257ebfe91dc7982c":"amp"};function N(a,b,c){this.handlers_=[];this.baseElement_=a;this.iframe_=b;this.is3p_=c||!1;this.inViewport_=this.shouldSendIntersectionChanges_=!1;this.pendingChanges_=[];this.flushTimeout_=0;this.boundFlush_=this.flush_.bind(this);this.init_()}m(N,G);N.prototype.init_=function(){var a=this;L(this.iframe_,"send-intersections",function(){a.startSendingIntersectionChanges_()},this.is3p_);this.add(function(){a.sendElementIntersection_()})};
N.prototype.startSendingIntersectionChanges_=function(){var a=this;this.shouldSendIntersectionChanges_=!0;this.baseElement_.getVsync().measure(function(){if(a.baseElement_.isInViewport())a.onViewportCallback(!0);a.fire()})};
N.prototype.onViewportCallback=function(a){if(this.inViewport_!=a)if(this.inViewport_=a,this.fire(),a){a=this.fire.bind(this);var b=this.baseElement_.getViewport().onScroll(a),c=this.baseElement_.getViewport().onChanged(a);this.unlistenViewportChanges_=function(){b();c()}}else this.unlistenViewportChanges_&&(this.unlistenViewportChanges_(),this.unlistenViewportChanges_=null)};
N.prototype.sendElementIntersection_=function(){if(this.shouldSendIntersectionChanges_){var a=this.baseElement_.element.getIntersectionChangeEntry();0<this.pendingChanges_.length&&this.pendingChanges_[this.pendingChanges_.length-1].time==a.time||(this.pendingChanges_.push(a),this.flushTimeout_||(this.flush_(),this.flushTimeout_=A.delay(this.boundFlush_,100)))}};
N.prototype.flush_=function(){this.flushTimeout_=0;if(this.pendingChanges_.length){var a=this.iframe_.src?y(this.iframe_.src).origin:"*";var b=this.iframe_,c={changes:this.pendingChanges_},d=this.is3p_;b.contentWindow&&(c.type="intersection",c.sentinel=M(d),d&&(c="amp-"+JSON.stringify(c)),b.contentWindow.postMessage(c,a));this.pendingChanges_.length=0}};var O=0,P=0;function Q(a){AMP.BaseElement.apply(this,arguments)}m(Q,AMP.BaseElement);Q.prototype.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a};
Q.prototype.assertSource=function(a,b,c){var d=y(a);u.assert("https:"==d.protocol||"data:"==d.protocol||0==d.origin.indexOf("http://iframe.localhost:"),"Invalid <amp-iframe> src. Must start with https://. Found %s",this.element);b=y(b);u.assert(!(" "+c+" ").match(/\s+allow-same-origin\s+/i)||d.origin!=b.origin&&"data:"!=d.protocol,"Origin of <amp-iframe> must not be equal to container %sif allow-same-origin is set. See https://github.com/ampproject/amphtml/blob/master/spec/amp-iframe-origin-policy.md for details.",
this.element);u.assert(!(v(d.hostname,".ampproject.net")||v(d.hostname,".ampproject.org")),"amp-iframe does not allow embedding of frames from ampproject.*: %s",a);return a};
Q.prototype.assertPosition=function(){var a=this.element.getLayoutBox(),b=Math.min(600,.75*this.getViewport().getSize().height);u.assert(a.top>=b,"<amp-iframe> elements must be positioned outside the first 75% of the viewport or 600px from the top (whichever is smaller): %s  Current position %s. Min: %sPositioning rules don't apply for iframes that use `placeholder`.See https://github.com/ampproject/amphtml/blob/master/extensions/amp-iframe/amp-iframe.md#iframe-with-placeholder for details.",this.element,
a.top,b)};Q.prototype.transformSrcDoc=function(a,b){if(a)return u.assert(!(" "+b+" ").match(/\s+allow-same-origin\s+/i),"allow-same-origin is not allowed with the srcdoc attribute %s.",this.element),"data:text/html;charset=utf-8;base64,"+btoa(a)};
Q.prototype.firstAttachedCallback=function(){this.sandbox_=this.element.getAttribute("sandbox");var a=this.element.getAttribute("src")||this.transformSrcDoc(this.element.getAttribute("srcdoc"),this.sandbox_);this.iframeSrc=this.assertSource(a,window.location.href,this.sandbox_);a=this.element;if("no"!=a.getAttribute("scrolling")){var b=a.ownerDocument.createElement("i-amp-scroll-container");a.appendChild(b);a=b}this.container_=a};
Q.prototype.preconnectCallback=function(a){this.iframeSrc&&this.preconnect.url(this.iframeSrc,a)};Q.prototype.buildCallback=function(){this.placeholder_=this.getPlaceholder();this.isClickToPlay_=!!this.placeholder_;this.iframe_=this.iframeLayoutBox_=this.unlistenViewportChanges_=null;(this.isResizable_=this.element.hasAttribute("resizable"))&&this.element.setAttribute("scrolling","no");this.intersectionObserver_=null};
Q.prototype.onLayoutMeasure=function(){this.measureIframeLayoutBox_();this.intersectionObserver_&&this.intersectionObserver_.fire()};Q.prototype.measureIframeLayoutBox_=function(){this.iframe_&&(this.iframeLayoutBox_=this.getViewport().getLayoutRect(this.iframe_))};Q.prototype.getIntersectionElementLayoutBox=function(){this.iframeLayoutBox_||this.measureIframeLayoutBox_();return this.iframeLayoutBox_};
Q.prototype.layoutCallback=function(){var a=this;this.isClickToPlay_||this.assertPosition();this.isResizable_&&u.assert(this.getOverflowElement(),"Overflow element must be defined for resizable frames: %s",this.element);if(!this.iframeSrc)return Promise.resolve();var b=this.looksLikeTrackingIframe_();if(b&&(P++,1<P))return console.error("Only 1 analytics/tracking iframe allowed per page. Please use amp-analytics instead or file a GitHub issue for your use case: https://github.com/ampproject/amphtml/issues/new"),
Promise.resolve();var c=this.element.getAttribute("width"),d=this.element.getAttribute("height"),e=this.element.ownerDocument.createElement("iframe");this.iframe_=e;this.applyFillContent(e);e.width=parseFloat(c);e.height=parseFloat(d);e.name="amp_iframe"+O++;this.isClickToPlay_&&(e.style.zIndex=-1);this.propagateAttributes(["frameborder","allowfullscreen","allowtransparency","scrolling"],e);e.setAttribute("sandbox",this.sandbox_||"");e.src=this.iframeSrc;b||(this.intersectionObserver_=new N(this,
e));e.onload=function(){e.readyState="complete";a.activateIframe_();b&&(a.iframeSrc=null,A.promise(5E3).then(function(){e.parentElement&&e.parentElement.removeChild(e);a.element.setAttribute("amp-removed","");a.iframe_=null}))};L(e,"embed-size",function(b){var c=void 0,d;void 0!==b.width&&(d=Math.max(a.element.offsetWidth+b.width-e.offsetWidth,b.width),e.width=b.width,a.element.setAttribute("width",d));void 0!==b.height&&(c=Math.max(a.element.offsetHeight+b.height-e.offsetHeight,b.height),e.height=
b.height,a.element.setAttribute("height",c));void 0===c&&void 0===d||a.updateSize_(c,d)});this.isClickToPlay_&&L(e,"embed-ready",this.activateIframe_.bind(this));this.container_.appendChild(e);return C(e).then(function(){a.container_!=a.element&&A.delay(function(){a.deferMutate(function(){a.container_.classList.add("amp-active")})},1E3)})};Q.prototype.unlayoutOnPause=function(){return!0};
Q.prototype.unlayoutCallback=function(){if(this.iframe_){var a=this.iframe_;a.parentElement&&a.parentElement.removeChild(a);this.placeholder_&&this.togglePlaceholder(!0);this.intersectionObserver_=this.iframe_=null}return!0};Q.prototype.viewportCallback=function(a){if(this.intersectionObserver_)this.intersectionObserver_.onViewportCallback(a)};Q.prototype.activateIframe_=function(){if(this.placeholder_){var a=this;this.getVsync().mutate(function(){a.iframe_&&(a.iframe_.style.zIndex=0,a.togglePlaceholder(!1))})}};
Q.prototype.firstLayoutCompleted=function(){};Q.prototype.updateSize_=function(a,b){this.isResizable_?this.attemptChangeSize(a,b):u.warn("amp-iframe","ignoring embed-size request because this iframe is not resizable",this.element)};Q.prototype.looksLikeTrackingIframe_=function(){var a=this.element.getLayoutBox();return 10<a.width&&10<a.height?!1:!0};AMP.registerElement("amp-iframe",Q);
});
//# sourceMappingURL=amp-iframe-0.1.js.map

